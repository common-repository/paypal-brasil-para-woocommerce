/*! For license information please see frontend-bcdc.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/frontend/frontend-bcdc/frontend-bcdc-api.ts":(e,t,a)=>{a.r(t),a.d(t,{paymentBCDC:()=>r});var n=a("./src/frontend/frontend-shared.ts");const r={create:e=>{if(e.errors)throw console.log("Erro"),new Error(e.errors);if(e.payment_id)return e.payment_id;throw new Error("An unexpected error occurred, please try again. If the error persists, please contact us. (#56)")},approve:e=>{jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-order-id]").val(e.orderID),jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-payer-id]").val(e.payerID),jQuery("#paypal-bcdc-fields [name=paypal-brasil-bcdc-pay-id]").val(e.paymentID),n.PaypalPayments.submitForm()},error:e=>{const t=jQuery("#wc-bcdc-brasil-api-error-data").val();if(t)n.PaypalPayments.triggerUpdateCheckout(),n.PaypalPayments.setNotices(JSON.parse(t)),n.PaypalPayments.scrollTop();else{var a='<ul class="woocommerce-error" role="alert"><li>'+e.message+"</li></ul>";n.PaypalPayments.triggerUpdateCheckout(),n.PaypalPayments.setNotices(a),n.PaypalPayments.scrollTop()}},cancel:()=>{n.PaypalPayments.triggerUpdateCheckout(),n.PaypalPayments.setNotices(paypal_brasil_bcdc_messages.cancel_message),n.PaypalPayments.scrollTop()}}},"./src/frontend/frontend-sdk/frontend-sdk-bcdc.ts":(e,t,a)=>{a.r(t),a.d(t,{importBcdcSdk:()=>r});var n=function(e,t,a,n){return new(a||(a=Promise))((function(r,o){function c(e){try{i(n.next(e))}catch(e){o(e)}}function l(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(c,l)}i((n=n.apply(e,t||[])).next())}))};const r={handle(){return n(this,void 0,void 0,(function*(){const e=paypal_brasil_bcdc_settings.client_id,t=paypal_brasil_bcdc_settings.currency,a=paypal_brasil_bcdc_settings.locale,n=document.getElementById("paypal-sdk-script"),r=`https://www.paypal.com/sdk/js?client-id=${e}&components=buttons,funding-eligibility,marks,marks&currency=${t}&locale=${a}`;if(n&&n.getAttribute("src")!==r||!n){const e=document.createElement("script");return e.id="paypal-sdk-script",e.async=!0,e.src=r,e.setAttribute("data-page-type","checkout"),document.head.appendChild(e),new Promise(((t,a)=>{e.onload=()=>{t()},e.onerror=e=>{console.error("Erro ao carregar o script do PayPal:",e),t()}}))}return Promise.resolve()}))}}},"./src/frontend/frontend-shared.ts":(e,t,a)=>{a.r(t),a.d(t,{PaypalPayments:()=>n});class n{static scrollTop(){jQuery("html, body").animate({scrollTop:0},300)}static setNotices(e){jQuery(".woocommerce-notices-wrapper:first").html(e)}static makeRequest(e,t){console.log(e);const a={async:!0,crossDomain:!0,url:n.replaceVars(paypal_brasil_settings.paypal_brasil_handler_url,{ACTION:e}),method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)};return jQuery.ajax(a)}static showDefaultButton(){jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#paypal-brasil-button-container .default-submit-button").show()}static showPaypalButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").show()}static showPaypalBCDCButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").show()}static isPaypalPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-spb-gateway:checked").length}static isPaypalBCDCPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-bcdc-gateway:checked").length}static triggerUpdateCheckout(){jQuery(document.body).trigger("update_checkout")}static triggerUpdateCart(){jQuery(document.body).trigger("wc_update_cart")}static submitForm(){jQuery("form.woocommerce-checkout, form#order_review").submit()}static submitFormCheckout(){jQuery("form.checkout.woocommerce-checkout").submit()}static replaceVars(e,t){let a=e;for(let e in t)t.hasOwnProperty(e)&&(a=a.replace(new RegExp("{"+e+"}","g"),t[e]));return a}}}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{a.r({});var e=a("./src/frontend/frontend-shared.ts"),t=a("./src/frontend/frontend-bcdc/frontend-bcdc-api.ts"),n=a("./src/frontend/frontend-sdk/frontend-sdk-bcdc.ts"),r=function(e,t,a,n){return new(a||(a=Promise))((function(r,o){function c(e){try{i(n.next(e))}catch(e){o(e)}}function l(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(c,l)}i((n=n.apply(e,t||[])).next())}))};class o extends e.PaypalPayments{constructor(){super(),this.sdkLoaded=!1,this.updateCheckout=(e=null)=>{e&&e.preventDefault(),this.triggerUpdateCheckout()},this.forceUpdateCheckout=(e=null)=>{e&&e.preventDefault(),jQuery(document.body).trigger("update_checkout")},this.triggerUpdateCheckout=this.debounce((()=>{this.forceUpdateCheckout()}),1e3),paypal_brasil_bcdc_settings.is_order_pay_page?this.initializeOrderPage():this.initializeCheckoutBcdc(),this.cartLabelTotal()}initializeOrderPage(){return r(this,void 0,void 0,(function*(){this.addPaypalBCDCButtonOnContainer(),this.renderPayPalButtonBcdc(),jQuery(document).on("updated_checkout","body",this.addPaypalBCDCButtonOnContainer),jQuery(document).on("updated_checkout","body",this.updateCheckoutButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.updateCheckoutButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.renderPayPalButtonBcdc),jQuery("form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.forceUpdateCheckout),this.listenInputChanges(),jQuery(document).on("updated_checkout","body",this.renderPayPalButtonBcdc)}))}initializeCheckoutBcdc(){return r(this,void 0,void 0,(function*(){jQuery(document).on("updated_checkout","body",this.addPaypalBCDCButtonOnContainer),jQuery(document).on("updated_checkout","body",this.updateCheckoutButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.updateCheckoutButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.renderPayPalButtonBcdc),jQuery("form.woocommerce-checkout, form#order_review").on("change","[name=payment_method],#payment_method_paypal-brasil-bcdc-gateway",this.forceUpdateCheckout),this.listenInputChanges(),jQuery(document).on("updated_checkout","body",this.renderPayPalButtonBcdc)}))}listenInputChanges(){jQuery(["[name=billing_first_name]","[name=billing_last_name]","[name=billing_cpf]","[name=billing_cnpj]","[name=billing_phone]","[name=billing_address_1]","[name=billing_number]","[name=billing_address_2]","[name=billing_neighborhood]","[name=billing_city]","[name=billing_state]","[name=billing_country]","[name=billing_email]"].join(",")).on("keyup",(()=>this.updateCheckout())),jQuery(["[name=billing_persontype]"].join(",")).on("change",(()=>this.updateCheckout()))}addPaypalBCDCButtonOnContainer(){if(!document.querySelector("#paypal-submit-button-bcdc")){var e=document.createElement("div"),t=document.createElement("div");e.className="paypal-submit-button-bcdc",t.id="paypal-button-bcdc";var a=document.querySelector("#paypal-brasil-button-container");a&&(a.appendChild(e),e.appendChild(t))}}updateCheckoutButtonBcdc(){e.PaypalPayments.isPaypalBCDCPaymentsSelected()?(e.PaypalPayments.showPaypalBCDCButton(),console.debug("bcdc change")):e.PaypalPayments.isPaypalPaymentsSelected()||(console.debug("default change"),e.PaypalPayments.showDefaultButton())}renderPayPalButtonBcdc(){return r(this,void 0,void 0,(function*(){var e=document.getElementById("payment_method_paypal-brasil-bcdc-gateway");if(e.checked){yield n.importBcdcSdk.handle();var a=document.getElementById("paypal-button-bcdc");if(a&&paypal_brasil_bcdc_settings.allowed_currency)a.innerHTML="",[paypal.FUNDING.CARD].forEach((e=>{const a=paypal.Buttons({style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",size:"full",tagline:"false"},fundingSource:e,createOrder:()=>{var e,a=null!==(e=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==e?e:null;try{if(a)return console.warn(a),a=JSON.parse(a),t.paymentBCDC.create(a)}catch(e){throw e}},onApprove:t.paymentBCDC.approve,onError:t.paymentBCDC.error,onCancel:t.paymentBCDC.cancel});a.isEligible()&&a.render("#paypal-button-bcdc")}))}else e.addEventListener("change",(function(){return r(this,void 0,void 0,(function*(){if(e.checked){yield n.importBcdcSdk.handle();var a=document.getElementById("paypal-button-bcdc");if(a&&paypal_brasil_bcdc_settings.allowed_currency)a.innerHTML="",[paypal.FUNDING.CARD].forEach((e=>r(this,void 0,void 0,(function*(){const a=paypal.Buttons({style:{layout:"vertical",color:"black",shape:"pill",label:"paypal",tagline:"false",size:"full"},fundingSource:e,createOrder:()=>{var e,a=null!==(e=jQuery("#wc-bcdc-brasil-data").val())&&void 0!==e?e:null;try{if(a)return console.warn(a),a=JSON.parse(a),t.paymentBCDC.create(a)}catch(e){throw e}},onApprove:t.paymentBCDC.approve,onError:t.paymentBCDC.error,onCancel:t.paymentBCDC.cancel});a.isEligible()&&a.render("#paypal-button-bcdc")}))))}}))}))}))}debounce(e,t,a=!1){let n;return function(){const r=this,o=arguments,c=a&&!n;clearTimeout(n),n=setTimeout((function(){n=null,a||e.apply(r,o)}),t),c&&e.apply(r,o)}}errorHandler(e){}cartLabelTotal(){if(paypal_brasil_bcdc_settings.is_order_pay_page){var e=document.querySelector("span.woocommerce-Price-currencySymbol");if(e.textContent)var t=e.textContent+" "+paypal_brasil_bcdc_order.order_pay_total;t&&(document.getElementById("bcdc-total-cart-label").textContent=t)}else jQuery(document.body).on("updated_checkout",(function(){var e=document.querySelector("tr.order-total");if(e){var t=e.querySelector("span.woocommerce-Price-amount");if(t){var a=t.textContent;document.getElementById("bcdc-total-cart-label").textContent=a}}}))}}new o})(),a.r(n)})();
//# sourceMappingURL=frontend-bcdc.js.map