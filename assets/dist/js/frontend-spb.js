/*! For license information please see frontend-spb.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/frontend/frontend-sdk/frontend-sdk-spb.ts":(e,t,a)=>{a.r(t),a.d(t,{importSpbSdk:()=>o});var r=function(e,t,a,r){return new(a||(a=Promise))((function(o,n){function c(e){try{p(r.next(e))}catch(e){n(e)}}function s(e){try{p(r.throw(e))}catch(e){n(e)}}function p(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(c,s)}p((r=r.apply(e,t||[])).next())}))};const o={handle(){return r(this,void 0,void 0,(function*(){const e=paypal_brasil_settings.currency,t=paypal_brasil_settings.client_id,a=paypal_brasil_settings.locale,r=document.getElementById("paypal-sdk-script"),o=`https://www.paypal.com/sdk/js?client-id=${t}&commit=false&currency=${e}&locale=${a}&disable-funding=card`;if(r&&r.getAttribute("src")!==o||!r){const e=document.createElement("script");return e.id="paypal-sdk-script",e.async=!0,e.src=o,e.setAttribute("data-page-type","checkout"),document.head.appendChild(e),new Promise(((t,a)=>{e.onload=()=>{t()},e.onerror=e=>{console.error("Erro ao carregar o script do PayPal:",e),t()}}))}return Promise.resolve()}))}}},"./src/frontend/frontend-shared.ts":(e,t,a)=>{a.r(t),a.d(t,{PaypalPayments:()=>r});class r{static scrollTop(){jQuery("html, body").animate({scrollTop:0},300)}static setNotices(e){jQuery(".woocommerce-notices-wrapper:first").html(e)}static makeRequest(e,t){console.log(e);const a={async:!0,crossDomain:!0,url:r.replaceVars(paypal_brasil_settings.paypal_brasil_handler_url,{ACTION:e}),method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)};return jQuery.ajax(a)}static showDefaultButton(){jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#paypal-brasil-button-container .default-submit-button").show()}static showPaypalButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").show()}static showPaypalBCDCButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button-bcdc").show()}static isPaypalPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-spb-gateway:checked").length}static isPaypalBCDCPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-bcdc-gateway:checked").length}static triggerUpdateCheckout(){jQuery(document.body).trigger("update_checkout")}static triggerUpdateCart(){jQuery(document.body).trigger("wc_update_cart")}static submitForm(){jQuery("form.woocommerce-checkout, form#order_review").submit()}static submitFormCheckout(){jQuery("form.checkout.woocommerce-checkout").submit()}static replaceVars(e,t){let a=e;for(let e in t)t.hasOwnProperty(e)&&(a=a.replace(new RegExp("{"+e+"}","g"),t[e]));return a}}},"./src/frontend/frontend-spb/frontend-spb-api.ts":(e,t,a)=>{a.r(t),a.d(t,{paymentSpb:()=>o});var r=a("./src/frontend/frontend-shared.ts");const o={create:()=>paypal_brasil_settings.is_order_pay_page?jQuery("#paypal-spb-fields [name=paypal-brasil-spb-order-pay-ec]").val():new Promise(((e,t)=>{r.PaypalPayments.makeRequest("checkout",{nonce:paypal_brasil_settings.nonce,first_name:jQuery("form.woocommerce-checkout [name=billing_first_name]").val(),last_name:jQuery("form.woocommerce-checkout [name=billing_last_name]").val(),country:jQuery("form.woocommerce-checkout [name=billing_country]").val(),address_line_1:jQuery("form.woocommerce-checkout [name=billing_address_1]").val(),address_line_2:jQuery("form.woocommerce-checkout [name=billing_address_2]").val(),number:jQuery("form.woocommerce-checkout [name=billing_number]").val(),city:jQuery("form.woocommerce-checkout [name=billing_city]").val(),state:jQuery("form.woocommerce-checkout [name=billing_state]").val(),neighborhood:jQuery("form.woocommerce-checkout [name=billing_neighborhood]").val(),postcode:jQuery("form.woocommerce-checkout [name=billing_postcode]").val(),phone:jQuery("form.woocommerce-checkout [name=billing_phone]").val()}).done((function(t){e(t.data.ec)})).fail((function(e){t(e.responseJSON)}))})),approve:e=>{jQuery("#paypal-spb-fields [name=paypal-brasil-spb-order-id]").val(e.orderID),jQuery("#paypal-spb-fields [name=paypal-brasil-spb-payer-id]").val(e.payerID),jQuery("#paypal-spb-fields [name=paypal-brasil-spb-pay-id]").val(e.paymentID),r.PaypalPayments.submitForm()},error:e=>{r.PaypalPayments.triggerUpdateCheckout(),e&&(r.PaypalPayments.setNotices(e.data.error_notice),r.PaypalPayments.scrollTop())},cancel:()=>{r.PaypalPayments.triggerUpdateCheckout(),r.PaypalPayments.setNotices(paypal_brasil_spb_settings.cancel_message),r.PaypalPayments.scrollTop()}}}},t={};function a(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{a.r({});var e=a("./src/frontend/frontend-shared.ts"),t=a("./src/frontend/frontend-spb/frontend-spb-api.ts"),r=a("./src/frontend/frontend-sdk/frontend-sdk-spb.ts"),o=function(e,t,a,r){return new(a||(a=Promise))((function(o,n){function c(e){try{p(r.next(e))}catch(e){n(e)}}function s(e){try{p(r.throw(e))}catch(e){n(e)}}function p(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(c,s)}p((r=r.apply(e,t||[])).next())}))};class n extends e.PaypalPayments{constructor(){super(),this.updateCheckout=(e=null)=>{e&&e.preventDefault(),this.triggerUpdateCheckout()},this.forceUpdateCheckout=(e=null)=>{e&&e.preventDefault(),jQuery(document.body).trigger("update_checkout")},this.triggerUpdateCheckout=this.debounce((()=>{this.forceUpdateCheckout()}),1e3),this.initializeCheckoutSpb()}initializeCheckoutSpb(){return o(this,void 0,void 0,(function*(){jQuery(document).on("updated_checkout","body",this.updateCheckoutButton),jQuery("form.woocommerce-checkout, form#order_review").on("change","#payment_method_paypal-brasil-spb-gateway",this.updateCheckoutButton),jQuery("form.woocommerce-checkout, form#order_review").on("change","#payment_method_paypal-brasil-spb-gateway",this.renderPayPalButtonSpb),jQuery("form.woocommerce-checkout, form#order_review").on("change","#payment_method_paypal-brasil-spb-gateway",this.forceUpdateCheckout),jQuery(document).on("updated_checkout","body",this.renderPayPalButtonSpb),paypal_brasil_settings.is_order_pay_page&&jQuery(document.body).trigger("updated_checkout")}))}updateCheckoutButton(){e.PaypalPayments.isPaypalPaymentsSelected()?e.PaypalPayments.showPaypalButton():e.PaypalPayments.showDefaultButton()}renderPayPalButtonSpb(){return o(this,void 0,void 0,(function*(){var e=document.getElementById("payment_method_paypal-brasil-spb-gateway");e.checked?(yield r.importSpbSdk.handle(),document.getElementById("paypal-button").innerHTML="",[paypal.FUNDING.PAYPAL].forEach((e=>{const a=paypal.Buttons({locale:"pt_BR",style:{size:"responsive",color:paypal_brasil_settings.style.color,shape:paypal_brasil_settings.style.format,label:"pay"},createOrder:t.paymentSpb.create,onApprove:t.paymentSpb.approve,onError:t.paymentSpb.error,onCancel:t.paymentSpb.cancel});a.isEligible()&&a.render("#paypal-button")}))):e.addEventListener("change",(function(){return o(this,void 0,void 0,(function*(){e.checked&&(yield r.importSpbSdk.handle(),document.getElementById("paypal-button").innerHTML="",[paypal.FUNDING.PAYPAL].forEach((e=>{const a=paypal.Buttons({locale:"pt_BR",style:{size:"responsive",color:paypal_brasil_settings.style.color,shape:paypal_brasil_settings.style.format,label:"pay"},fundingSource:e,createOrder:t.paymentSpb.create,onApprove:t.paymentSpb.approve,onError:t.paymentSpb.error,onCancel:t.paymentSpb.cancel});a.isEligible()&&a.render("#paypal-button")})))}))}))}))}debounce(e,t,a=!1){let r;return function(){const o=this,n=arguments,c=a&&!r;clearTimeout(r),r=setTimeout((function(){r=null,a||e.apply(o,n)}),t),c&&e.apply(o,n)}}errorHandler(e){}}new n})(),a.r(r)})();
//# sourceMappingURL=frontend-spb.js.map